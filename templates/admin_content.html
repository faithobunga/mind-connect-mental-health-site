<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Management - CUEA MindConnect Admin</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #ecf0f1;
            --card-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), #34495e);
            padding: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar .nav-link {
            color: #bdc3c7;
            padding: 15px 20px;
            border-radius: 0;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: rgba(255,255,255,0.1);
            border-left-color: var(--secondary-color);
        }

        .sidebar .nav-link i {
            width: 20px;
            margin-right: 10px;
        }

        .main-content {
            padding: 20px;
        }

        .content-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--card-shadow);
            margin-bottom: 20px;
        }

        .btn-action {
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .category-badge {
            font-size: 0.8rem;
            padding: 0.3rem 0.6rem;
        }

        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }

        .table th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            font-weight: 600;
        }

        .table td {
            vertical-align: middle;
            border-color: #dee2e6;
        }

        .content-preview {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .modal .form-control, .modal .form-select {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: border-color 0.3s ease;
        }

        .modal .form-control:focus, .modal .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
        }

        .stats-row {
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--secondary-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        #contentEditor {
            min-height: 200px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4 class="text-white">Admin Panel</h4>
                        <small class="text-muted">CUEA MindConnect</small>
                    </div>
                    
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                                <i class="fas fa-tachometer-alt"></i>
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_users') }}">
                                <i class="fas fa-users"></i>
                                User Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_counselors') }}">
                                <i class="fas fa-user-md"></i>
                                Counselor Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_appointments') }}">
                                <i class="fas fa-calendar-check"></i>
                                Appointments
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="{{ url_for('admin_content') }}">
                                <i class="fas fa-file-alt"></i>
                                Content Management
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_forum_oversight') }}">
                                <i class="fas fa-comments"></i>
                                Forum Oversight
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_analytics') }}">
                                <i class="fas fa-chart-bar"></i>
                                Analytics
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_settings') }}">
                                <i class="fas fa-cog"></i>
                                Settings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('admin_system_health') }}">
                                <i class="fas fa-heartbeat"></i>
                                System Health
                            </a>
                        </li>
                        <li class="nav-item mt-4">
                            <a class="nav-link" href="{{ url_for('logout') }}">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Content Management</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addContentModal">
                            <i class="fas fa-plus"></i> Add New Content
                        </button>
                    </div>
                </div>

                <!-- Flash Messages -->
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <!-- Statistics Row -->
                <div class="row stats-row">
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number">{{ total_resources }}</div>
                            <div class="stat-label">Total Resources</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number">{{ featured_resources }}</div>
                            <div class="stat-label">Featured Resources</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number">{{ articles_count }}</div>
                            <div class="stat-label">Articles</div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="stat-card">
                            <div class="stat-number">{{ categories_count }}</div>
                            <div class="stat-label">Categories</div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="content-card">
                    <div class="row">
                        <div class="col-md-4">
                            <select class="form-select" id="categoryFilter">
                                <option value="">All Categories</option>
                                <option value="article">Articles</option>
                                <option value="video">Videos</option>
                                <option value="meditation">Meditation</option>
                                <option value="exercise">Exercise</option>
                                <option value="guide">Guides</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <select class="form-select" id="typeFilter">
                                <option value="">All Types</option>
                                <option value="internal">Internal Content</option>
                                <option value="external_link">External Links</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchContent" placeholder="Search content...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Table -->
                <div class="content-card">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Category</th>
                                    <th>Type</th>
                                    <th>Featured</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="contentTableBody">
                                {% for resource in resources %}
                                <tr>
                                    <td>
                                        <div class="fw-bold">{{ resource.title }}</div>
                                        <div class="text-muted content-preview">{{ resource.content[:100] }}...</div>
                                    </td>
                                    <td>
                                        <span class="badge category-badge bg-primary">
                                            {{ resource.category.title() }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-{{ 'success' if resource.resource_type == 'internal' else 'info' }}">
                                            {{ resource.resource_type.replace('_', ' ').title() }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if resource.is_featured %}
                                            <i class="fas fa-star text-warning"></i>
                                        {% else %}
                                            <i class="far fa-star text-muted"></i>
                                        {% endif %}
                                    </td>
                                    <td>{{ resource.created_at.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary btn-action" 
                                                onclick="viewContent({{ resource.id }})" title="View">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-warning btn-action" 
                                                onclick="editContent({{ resource.id }})" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-{{ 'warning' if resource.is_featured else 'success' }} btn-action" 
                                                onclick="toggleFeatured({{ resource.id }})" title="Toggle Featured">
                                            <i class="fas fa-star"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger btn-action" 
                                                onclick="deleteContent({{ resource.id }})" title="Delete">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Add Content Modal -->
    <div class="modal fade" id="addContentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Content</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="addContentForm" method="POST" action="{{ url_for('admin_add_content') }}" enctype="multipart/form-data">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="title" class="form-label">Title *</label>
                                    <input type="text" class="form-control" id="title" name="title" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="category" class="form-label">Category *</label>
                                    <select class="form-select" id="category" name="category" required>
                                        <option value="">Select Category</option>
                                        <option value="article">Article</option>
                                        <option value="video">Video</option>
                                        <option value="meditation">Meditation</option>
                                        <option value="exercise">Exercise</option>
                                        <option value="guide">Guide</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="resource_type" class="form-label">Resource Type *</label>
                                    <select class="form-select" id="resource_type" name="resource_type" required onchange="toggleUrlField()">
                                        <option value="internal">Internal Content</option>
                                        <option value="external_link">External Link</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="tags" class="form-label">Tags</label>
                                    <input type="text" class="form-control" id="tags" name="tags" 
                                           placeholder="stress, wellness, study (comma-separated)">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="urlField" style="display: none;">
                            <label for="url" class="form-label">External URL</label>
                            <input type="url" class="form-control" id="url" name="url" 
                                   placeholder="https://example.com">
                        </div>

                        <div class="mb-3">
                            <label for="content" class="form-label">Content *</label>
                            <textarea class="form-control" id="contentEditor" name="content" rows="8" required></textarea>
                        </div>

                        <div class="mb-3">
                            <label for="file" class="form-label">Upload File (Optional)</label>
                            <input type="file" class="form-control" id="file" name="file" 
                                   accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif">
                            <div class="form-text">Supported formats: PDF, DOC, DOCX, JPG, PNG, GIF (Max 10MB)</div>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="is_featured" name="is_featured">
                            <label class="form-check-label" for="is_featured">
                                Feature this content
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Content</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Content Modal -->
    <div class="modal fade" id="editContentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Content</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form id="editContentForm">
                    <div class="modal-body">
                        <input type="hidden" id="editContentId">
                        <!-- Same fields as add modal -->
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="editTitle" class="form-label">Title *</label>
                                    <input type="text" class="form-control" id="editTitle" name="title" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="editCategory" class="form-label">Category *</label>
                                    <select class="form-select" id="editCategory" name="category" required>
                                        <option value="article">Article</option>
                                        <option value="video">Video</option>
                                        <option value="meditation">Meditation</option>
                                        <option value="exercise">Exercise</option>
                                        <option value="guide">Guide</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editResourceType" class="form-label">Resource Type *</label>
                                    <select class="form-select" id="editResourceType" name="resource_type" required>
                                        <option value="internal">Internal Content</option>
                                        <option value="external_link">External Link</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="editTags" class="form-label">Tags</label>
                                    <input type="text" class="form-control" id="editTags" name="tags">
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="editUrlField">
                            <label for="editUrl" class="form-label">External URL</label>
                            <input type="url" class="form-control" id="editUrl" name="url">
                        </div>

                        <div class="mb-3">
                            <label for="editContent" class="form-label">Content *</label>
                            <textarea class="form-control" id="editContent" name="content" rows="8" required></textarea>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="editIsFeatured" name="is_featured">
                            <label class="form-check-label" for="editIsFeatured">
                                Feature this content
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Update Content</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Content Modal -->
    <div class="modal fade" id="viewContentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewContentTitle">Content Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="viewContentBody">
                    <!-- Content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
     <script src="/static/script.js"></script>
    <script>
        
function toggleUrlField() {
    const resourceType = document.getElementById('resource_type').value;
    const urlField = document.getElementById('urlField');
    const urlInput = document.getElementById('url');
    
    if (resourceType === 'external_link') {
        urlField.style.display = 'block';
        urlInput.required = true;
    } else {
        urlField.style.display = 'none';
        urlInput.required = false;
    }
}

// Document ready handler
document.addEventListener('DOMContentLoaded', function() {
    console.log('Content management loaded');
    
    // Initialize URL field toggle
    toggleUrlField();
    
    // Handle add content form submission
    const addForm = document.getElementById('addContentForm');
    if (addForm) {
        addForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            submitBtn.disabled = true;
            
            fetch('/admin/content/add', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    showNotification('Content added successfully!', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addContentModal'));
                    if (modal) modal.hide();
                    setTimeout(() => location.reload(), 1000);
                } else {
                    throw new Error('Server error: ' + response.status);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to add content. Please try again.', 'error');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
    }
    
    // Filter events
    document.getElementById('categoryFilter')?.addEventListener('change', filterContent);
    document.getElementById('typeFilter')?.addEventListener('change', filterContent);
    document.getElementById('searchContent')?.addEventListener('input', filterContent);
});

// View content
function viewContent(contentId) {
    fetch(`/api/admin/content/${contentId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                const content = data.content;
                document.getElementById('viewContentTitle').textContent = content.title;
                
                let bodyHtml = `
                    <div class="row">
                        <div class="col-md-6"><strong>Category:</strong> ${content.category}</div>
                        <div class="col-md-6"><strong>Type:</strong> ${content.resource_type}</div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-md-6"><strong>Featured:</strong> ${content.is_featured ? 'Yes' : 'No'}</div>
                        <div class="col-md-6"><strong>Created:</strong> ${content.created_at}</div>
                    </div>
                    ${content.tags ? `<div class="mt-2"><strong>Tags:</strong> ${content.tags}</div>` : ''}
                    ${content.url ? `<div class="mt-2"><strong>URL:</strong> <a href="${content.url}" target="_blank">${content.url}</a></div>` : ''}
                    ${content.file_url ? `<div class="mt-2"><strong>File:</strong> <a href="${content.file_url}" target="_blank">View File</a></div>` : ''}
                    <hr>
                    <div class="mt-3">
                        <h6>Content:</h6>
                        <div style="max-height: 300px; overflow-y: auto; padding: 15px; background-color: #f8f9fa; border-radius: 8px;">
                            ${content.content}
                        </div>
                    </div>
                `;
                
                document.getElementById('viewContentBody').innerHTML = bodyHtml;
                new bootstrap.Modal(document.getElementById('viewContentModal')).show();
            } else {
                throw new Error(data.message || 'Failed to load content');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Failed to load content details: ' + error.message, 'error');
        });
}

// Edit content
function editContent(contentId) {
    fetch(`/api/admin/content/${contentId}`)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                const content = data.content;
                document.getElementById('editContentId').value = content.id;
                document.getElementById('editTitle').value = content.title;
                document.getElementById('editCategory').value = content.category;
                document.getElementById('editResourceType').value = content.resource_type;
                document.getElementById('editTags').value = content.tags || '';
                document.getElementById('editUrl').value = content.url || '';
                document.getElementById('editContent').value = content.content;
                document.getElementById('editIsFeatured').checked = content.is_featured;
                
                // Toggle URL field
                toggleEditUrlField();
                
                new bootstrap.Modal(document.getElementById('editContentModal')).show();
            } else {
                throw new Error(data.message || 'Failed to load content');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Failed to load content for editing: ' + error.message, 'error');
        });
}

function toggleEditUrlField() {
    const resourceType = document.getElementById('editResourceType')?.value;
    const urlField = document.getElementById('editUrlField');
    
    if (resourceType === 'external_link') {
        urlField.style.display = 'block';
    } else {
        urlField.style.display = 'none';
    }
}

// Handle edit form submission
document.addEventListener('DOMContentLoaded', function() {
    const editForm = document.getElementById('editContentForm');
    if (editForm) {
        editForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const contentId = document.getElementById('editContentId').value;
            const formData = new FormData();
            
            formData.append('title', document.getElementById('editTitle').value);
            formData.append('category', document.getElementById('editCategory').value);
            formData.append('resource_type', document.getElementById('editResourceType').value);
            formData.append('tags', document.getElementById('editTags').value);
            formData.append('url', document.getElementById('editUrl').value);
            formData.append('content', document.getElementById('editContent').value);
            formData.append('is_featured', document.getElementById('editIsFeatured').checked);
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
            submitBtn.disabled = true;
            
            fetch(`/api/admin/content/${contentId}/edit`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Content updated successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('editContentModal')).hide();
                    setTimeout(() => location.reload(), 1000);
                } else {
                    throw new Error(data.message || 'Failed to update content');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to update content: ' + error.message, 'error');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        });
    }
});

// Toggle featured status
function toggleFeatured(contentId) {
    const button = event.target.closest('button');
    const originalHtml = button.innerHTML;
    
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    button.disabled = true;
    
    fetch(`/api/admin/content/${contentId}/toggle-featured`, {
        method: 'POST'
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showNotification(data.message, 'success');
            
            // Update button appearance
            const icon = button.querySelector('i');
            if (data.is_featured) {
                button.className = 'btn btn-sm btn-outline-warning btn-action';
                icon.className = 'fas fa-star';
            } else {
                button.className = 'btn btn-sm btn-outline-success btn-action';
                icon.className = 'fas fa-star';
            }
            
            // Update the star in the table
            const row = button.closest('tr');
            const starCell = row.querySelector('td:nth-child(4)');
            if (data.is_featured) {
                starCell.innerHTML = '<i class="fas fa-star text-warning"></i>';
            } else {
                starCell.innerHTML = '<i class="far fa-star text-muted"></i>';
            }
        } else {
            throw new Error('Failed to update featured status');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showNotification('Failed to update featured status', 'error');
    })
    .finally(() => {
        button.innerHTML = originalHtml;
        button.disabled = false;
    });
}

// Delete content
function deleteContent(contentId) {
    const row = event.target.closest('tr');
    const title = row.querySelector('.fw-bold').textContent;
    
    if (confirm(`Are you sure you want to delete "${title}"? This action cannot be undone.`)) {
        const button = event.target.closest('button');
        const originalHtml = button.innerHTML;
        
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
        button.disabled = true;
        
        fetch(`/api/admin/content/${contentId}/delete`, {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(data.message, 'success');
                
                // Remove row with animation
                row.style.transition = 'opacity 0.3s ease';
                row.style.opacity = '0';
                setTimeout(() => {
                    row.remove();
                }, 300);
            } else {
                throw new Error(data.message || 'Failed to delete content');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Failed to delete content: ' + error.message, 'error');
            
            button.innerHTML = originalHtml;
            button.disabled = false;
        });
    }
}

// Filter functionality
function filterContent() {
    const category = document.getElementById('categoryFilter')?.value.toLowerCase() || '';
    const type = document.getElementById('typeFilter')?.value.toLowerCase() || '';
    const search = document.getElementById('searchContent')?.value.toLowerCase() || '';
    
    const rows = document.querySelectorAll('#contentTableBody tr');
    
    rows.forEach(row => {
        const categoryCell = row.cells[1].textContent.toLowerCase();
        const typeCell = row.cells[2].textContent.toLowerCase();
        const titleCell = row.cells[0].textContent.toLowerCase();
        
        const categoryMatch = !category || categoryCell.includes(category);
        const typeMatch = !type || typeCell.includes(type.replace('_', ' '));
        const searchMatch = !search || titleCell.includes(search);
        
        if (categoryMatch && typeMatch && searchMatch) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
}

// Notification function
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'error' ? 'danger' : type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentNode) {
            notification.classList.remove('show');
            setTimeout(() => notification.remove(), 150);
        }
    }, 5000);
}
    </script>
</body>
</html>